{% extends "layout.html" %}

{% block title %}ZXZ{% endblock %}

{% block content %}
{% set fhost_url = url_for("fhost", _external=True).rstrip("/") %}
<div class="col-md-12 mb-4">
    <h2 id="the-null-pointer">THE NULL POINTER</h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <ul>
                <li>HTTP POST files here:</li>
                <pre><code>curl -F'file=@yourfile.png' {{ fhost_url }}</code></pre>
                <li>You can also POST remote URLs:</li>
                <pre><code>curl -F'url=http://example.com/image.jpg' {{ fhost_url }}</code></pre>
                <li>If you don't want the resulting URL to be easy to guess:</li>
                <pre><code>curl -F'file=@yourfile.png' -Fsecret= {{ fhost_url }}</code>
<code>curl -F'url=http://example.com/image.jpg' -Fsecret= {{ fhost_url }}</code></pre>
                <li>Or you can shorten URLs:</li>
                <pre><code>curl -F'shorten=http://example.com/some/long/url' {{ fhost_url }}</code></pre>
                <li>It is possible to append your own file name to the URL:</li>
                <pre><code>{{ fhost_url }}/aaa.jpg/image.jpeg</code></pre>
            </ul>
            <p><b>File URLs are valid for at least 30 days and up to a year (see below).</b></p>
            <ul>
                <li>Files can be set to expire sooner by adding an "expires" parameter (in hours)</li>
                <pre><code>curl -F'file=@yourfile.png' -Fexpires=24 http://192.168.120.107:5000</code></pre>
                <li>OR by setting "expires" to a timestamp in epoch milliseconds</li>
                <pre><code>curl -F'file=@yourfile.png' -Fexpires=1681996320000 http://192.168.120.107:5000</code></pre>
            </ul>

            <p>Expired files won't be removed immediately, but will be removed as part of the next purge.
            <p>
            <p>Whenever a file that does not already exist or has expired is uploaded, the HTTP response header includes
                an X-Token field. You can use this to perform management operations on the file.
            <p>

            <ul>
                <li>To delete the file immediately:</li>
                <pre><code>curl -Ftoken=token_here -Fdelete= {{ fhost_url }}/abc.txt</code></pre>
                <li>To change the expiration date (see above):</li>
                <pre><code>curl -Ftoken=token_here -Fexpires=3 {{ fhost_url }}/abc.txt</code></pre>
            </ul>

            {% set max_size = config["MAX_CONTENT_LENGTH"]|filesizeformat(True) %}
            <p>Maximum file size: <b>{{ max_size }}</b></p>
            <p>Not allowed:
                {% for item in config["FHOST_MIME_BLACKLIST"] %}
                <code>{{ item }}</code>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4">
    <h2 id="terms-of-service">TERMS OF SERVICE</h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <ul>
                <li><code>{{ fhost_url }}</code> is NOT a platform for:</li>
                <ul>
                    <li>piracy</li>
                    <li>pornography and gore</li>
                    <li>extremist material of any kind</li>
                    <li>malware / botnet C&C</li>
                    <li>anything related to crypto currencies</li>
                    <li>backups (yes, this includes your minecraft stuff, seriously people have been dumping terabytes
                        of it here for years)</li>
                    <li>CI build artifacts</li>
                    <li>doxxing, database dumps containing personal information</li>
                    <li>anything illegal under Australian law</li>
                </ul>
            </ul>
            <p>Uploads found to be in violation of these rules will be removed, and the originating IP address blocked
                from further uploads.</p>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4">
    <h2 id="web-upload">WEB UPLOAD</h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <form id="fileUploadForm" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="file" class="form-label">Choose File</label>
                    <input type="file" class="form-control" id="file" name="file" onchange="clearResponseText('response')">
                </div>
                <div class="mb-3">
                    <input type="checkbox" id="enableSecret" onchange="toggleSecret()">
                    <label for="secret" class="form-label">Secret</label>
                    <input type="text" class="form-control" id="secret" name="secret" disabled>
                </div>
                <div class="mb-3">
                    <input type="checkbox" id="enableExpiration" onchange="toggleExpiration()">
                    <label for="datetimepicker" class="form-label">Select Expiration Date and Time</label>
                    <input type="datetime-local" class="form-control" id="datetimepicker" name="datetimepicker" disabled>
                    <input type="hidden" class="form-control" id="expires" name="expires" disabled>
                </div>
                <div class="mb-3 d-flex align-items-center">
                    <button id="submit-btn" type="button" class="btn btn-primary" style="margin-right: 10px;" onclick="submitForm()">Submit</button>
                    <div id="spinner-submit" class="spinner-border" role="status" style="display: none;"></div>
                </div>
            </form>
            <div id="response" class="mt-3" style="display: none;"></div>
            <div class="modal fade" id="qrCodeModal-response" tabindex="-1" aria-labelledby="qrCodeModalLabel-response" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="qrCodeModalLabel-response">Scan QR code</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body d-flex justify-content-center align-items-center">
                            <div id="qrCodeContainer-response"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4">
    <h2 id="shorten-url">SHORTEN URL</h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <form id="shortenUrlForm" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="shorten" class="form-label">URL</label>
                    <input type="text" class="form-control" id="shorten" name="shorten">
                </div>
                <div class="mb-3 d-flex align-items-center">
                    <button id="submit-shorten-url-btn" type="button" class="btn btn-primary" style="margin-right: 10px;" onclick="submitShortenUrl()">Submit</button>
                    <div id="spinner-submit-shorten-url" class="spinner-border" role="status" style="display: none;"></div>
                </div>
            </form>
            <div id="responseShortenUrl" class="mt-3" style="display: none; position: relative;"></div>
            <div class="modal fade" id="qrCodeModal-responseShortenUrl" tabindex="-1" aria-labelledby="qrCodeModalLabel-responseShortenUrl" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="qrCodeModalLabel-responseShortenUrl">Scan QR code</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body d-flex justify-content-center align-items-center">
                            <div id="qrCodeContainer-responseShortenUrl"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4">
    <h2 id="operator-notes">OPERATOR NOTES</h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <p>If you run a server and like this site, clone it! Centralization is bad.</p>
            <a href="https://git.0x0.st/mia/0x0">https://git.0x0.st/mia/0x0</a>
            <p>Hosting costs about 60 EUR a month.</p>
            <p>You can also support Original author Mia financially via libreapay.</p>
            <div class="col-md-12" style="margin-bottom: 20px;">
                <a href="https://liberapay.com/mia/donate">
                    <img src="https://img.shields.io/liberapay/receives/mia.svg?logo=liberapay">
                </a>
            </div>
            <p>If you wish to make just a small one-time donation, that is cool too!</p>
            <p>It will go towards my coffee habits.</p>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4">
    <h2 id="file-retention-period">FILE RETENTION PERIOD</h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <p><code>retention = min_age + (-max_age + min_age) * pow((file_size / max_size - 1), 3)</code></p>
            <!-- Render plot -->
            <canvas id="retentionChart"></canvas>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js"></script>
<!-- Bootstrap Chart JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0"></script>
<!-- Bootstrap Datepicker JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/default-passive-events"></script>
<!-- Bootstrap QR Code generation JS -->
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<!-- Customize JS -->
<script src="{{ url_for('static', filename='app.js') }}"></script>
<script type="text/javascript">
    var min_age = {{'{: 6}'.format(config.get("FHOST_MIN_EXPIRATION", 2592000000)/86400000)}};
    var max_age = {{'{: 6}'.format(config.get("FHOST_MAX_EXPIRATION", 2592000000)/86400000)}};
    var max_size = {{'{: 6}'.format(config["MAX_CONTENT_LENGTH"] / 1024 / 1024)}};
    
    function calculate_retention(file_size, min_age, max_age, max_size) {
        return min_age + (-max_age + min_age) * Math.pow((file_size / max_size - 1), 3);
    }
    
    var data_x = [];
    var data_y = [];
    for (let i = 0; i <= 512; i += 1) {
        data_x.push(i);
        data_y.push(calculate_retention(i, min_age, max_age, max_size));
    }
    
    var retentionChart = new Chart(document.getElementById('retentionChart'), {
        type: 'line',
        data: {
            labels: data_x,
            datasets: [{
                label: 'Retention',
                data: data_y,
                borderColor: '#d882d2',
                fill: false
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'File Size (MB)'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Retention (Days)'
                    },
                    suggestedMin: 0
                }
            }
        }
    });
</script>
{% endblock %}