{% extends "layout.html" %}

{% block title %}ZXZ{% endblock %}

{% block content %}
{% set fhost_url = url_for("fhost", _external=True).rstrip("/") %}
{% set min_age = '{: 6.0f}'.format(config.get("FHOST_MIN_EXPIRATION", 2592000000)/86400000) %}
{% set max_age = '{: 6.0f}'.format(config.get("FHOST_MAX_EXPIRATION", 2592000000)/86400000) %}
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="the-null-pointer">
        <span>THE NULL POINTER</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#the-null-pointer" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <ul>
                <li>HTTP POST files here:</li>
                <pre><code>curl -F'file=@yourfile.png' {{ fhost_url }}</code></pre>
                <li>You can also POST remote URLs:</li>
                <pre><code>curl -F'url=http://example.com/image.jpg' {{ fhost_url }}</code></pre>
                <li>If you don't want the resulting URL to be easy to guess:</li>
                <pre><code>curl -F'file=@yourfile.png' -Fsecret= {{ fhost_url }}</code>
<code>curl -F'url=http://example.com/image.jpg' -Fsecret= {{ fhost_url }}</code></pre>
                <li>Or you can shorten URLs:</li>
                <pre><code>curl -F'shorten=http://example.com/some/long/url' {{ fhost_url }}</code></pre>
                <li>It is possible to append your own file name to the URL:</li>
                <pre><code>{{ fhost_url }}/aaa.jpg/image.jpeg</code></pre>
            </ul>
            <p><b>File URLs are valid for at least {{ min_age }} days and up to {{ max_age }} days (<a href="#file-retention-period">see below</a>).</b></p>
            <ul>
                <li>Files can be set to expire sooner by adding an "expires" parameter (in hours)</li>
                <pre><code>curl -F'file=@yourfile.png' -Fexpires=24 http://192.168.120.107:5000</code></pre>
                <li>OR by setting "expires" to a timestamp in epoch milliseconds</li>
                <pre><code>curl -F'file=@yourfile.png' -Fexpires=1681996320000 http://192.168.120.107:5000</code></pre>
            </ul>

            <p>Expired files won't be removed immediately, but will be removed as part of the next purge.</p>
            <p>Whenever a file that does not already exist or has expired is uploaded, the HTTP response header includes an X-Token field. You can use this to perform management operations on the file.</p>

            <ul>
                <li>To delete the file immediately:</li>
                <pre><code>curl -Ftoken=token_here -Fdelete= {{ fhost_url }}/abc.txt</code></pre>
                <li>To change the expiration date (see above):</li>
                <pre><code>curl -Ftoken=token_here -Fexpires=3 {{ fhost_url }}/abc.txt</code></pre>
            </ul>

            {% set max_size = config["MAX_CONTENT_LENGTH"]|filesizeformat(True) %}
            <p>Maximum file size: <b>{{ max_size }}</b></p>
            <p>Not allowed:
                {% for item in config["FHOST_MIME_BLACKLIST"] %}
                <code>{{ item }}</code>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="terms-of-service">
        <span>TERMS OF SERVICE</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#terms-of-service" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <ul>
                <li><code>{{ fhost_url }}</code> is NOT a platform for:</li>
                <ul>
                    <li>piracy</li>
                    <li>pornography and gore</li>
                    <li>extremist material of any kind</li>
                    <li>malware / botnet C&C</li>
                    <li>anything related to crypto currencies</li>
                    <li>backups (yes, this includes your minecraft stuff, seriously people have been dumping terabytes of it here for years)</li>
                    <li>CI build artifacts</li>
                    <li>doxxing, database dumps containing personal information</li>
                    <li>anything illegal under Australian law</li>
                </ul>
            </ul>
            <p>Uploads found to be in violation of these rules will be removed, and the originating IP address blocked from further uploads.</p>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="web-upload">
        <span>WEB UPLOAD</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#web-upload" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <form id="fileUploadForm" enctype="multipart/form-data">
                <div class="mb-3">
                    <div class="d-flex align-items-center">
                        <label for="file" class="form-label">Choose File</label>
                        <div id="checkmark-pasting" class="checkmark hide">
                            <svg version="1.1" x="0px" y="0px" width="18px" height="18px" viewBox="0, 0, 100, 100" id="checkmark-svg">
                                <g transform="">
                                    <circle id="path-pasting" class="path" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                    <circle id="fill-pasting" class="fill" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                    <polyline id="check-pasting" class="check" fill="none" stroke="#7DB0D5" stroke-width="14" stroke-linecap="round" stroke-miterlimit="10" points="70,35 45,65 30,52"/>
                                </g>
                            </svg>
                        </div>
                    </div>
                    <input type="file" class="form-control" id="file" name="file">
                    <div id="file-feedback" class="invalid-feedback">Please choose a file.</div>
                </div>
                <div class="mb-3">
                    <!--<input type="checkbox" id="enableSecret" onchange="toggleSecret()">-->
                    <label for="secret" class="form-label">Secret</label>
                    <div class="input-group">
                        <div class="input-group-text">
                            <input class="form-check-input mt-0" type="checkbox" id="enableSecret" onchange="toggleSecret()">
                        </div>
                        <input type="text" class="form-control" id="secret" name="secret" disabled>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="datetimepicker" class="form-label">Expiration Date and Time</label>
                    <div class="input-group">
                        <div class="input-group-text">
                            <input class="form-check-input mt-0" type="checkbox" id="enableExpiration" onchange="toggleExpiration()">
                        </div>
                        <input type="datetime-local" class="form-control" id="datetimepicker" name="datetimepicker" disabled>
                    </div>
                    <input type="hidden" class="form-control" id="expires" name="expires" disabled>
                </div>
                <div class="mb-3 d-flex align-items-center">
                    <button id="submit-btn" type="button" class="btn btn-primary" onclick="submitForm()">Submit</button>
                    <div id="checkmark-submit" class="checkmark hide" style="padding-top: 3px">
                        <svg version="1.1" x="0px" y="0px" width="30px" height="30px" viewBox="0, 0, 100, 100" id="checkmark-svg">
                            <g transform="">
                                <circle id="path-submit" class="path" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <circle id="fill-submit" class="fill" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <polyline id="check-submit" class="check" fill="none" stroke="#7DB0D5" stroke-width="14" stroke-linecap="round" stroke-miterlimit="10" points="70,35 45,65 30,52"/>
                            </g>
                        </svg>
                    </div>
                </div>
            </form>
            <div id="response" class="mt-3" style="display: none;"></div>
            <div class="modal fade" id="qrCodeModal-response" tabindex="-1" aria-labelledby="qrCodeModalLabel-response" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="qrCodeModalLabel-response">Scan QR code</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body d-flex justify-content-center align-items-center">
                            <div id="qrCodeContainer-response"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="shorten-url">
        <span>SHORTEN URL</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#shorten-url" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <form id="shortenUrlForm" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="shorten" class="form-label">URL</label>
                    <input type="text" class="form-control" id="shorten" name="shorten">
                    <div id="shorten-feedback" class="invalid-feedback">Please enter an URL.</div>
                </div>
                <div class="mb-3 d-flex align-items-center">
                    <button id="submit-shorten-url-btn" type="button" class="btn btn-primary" style="margin-right: 10px;" onclick="submitShortenUrl()">Submit</button>
                    <div id="checkmark-submit-shorten-url" class="checkmark hide" style="padding-top: 3px">
                        <svg version="1.1" x="0px" y="0px" width="30px" height="30px" viewBox="0, 0, 100, 100" id="checkmark-svg">
                            <g transform="">
                                <circle id="path-submit-shorten-url" class="path" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <circle id="fill-submit-shorten-url" class="fill" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <polyline id="check-submit-shorten-url" class="check" fill="none" stroke="#7DB0D5" stroke-width="14" stroke-linecap="round" stroke-miterlimit="10" points="70,35 45,65 30,52"/>
                            </g>
                        </svg>
                    </div>
                </div>
            </form>
            <div id="response-shorten-url" class="mt-3" style="display: none; position: relative;"></div>
            <div class="modal fade" id="qrCodeModal-response-shorten-url" tabindex="-1" aria-labelledby="qrCodeModalLabel-response-shorten-url" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="qrCodeModalLabel-response-shorten-url">Scan QR code</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body d-flex justify-content-center align-items-center">
                            <div id="qrCodeContainer-response-shorten-url"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="text-editor-sect">
        <span>TEXT EDITOR</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#text-editor-sect" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <div class="input-group mb-3">
                <input type="text" id="download-url" class="form-control" placeholder="Download link" aria-label="Download link" aria-describedby="get-data-from-url">
                <button class="btn btn-outline-primary" type="button" id="get-data-from-url" onclick="getFileFromUrl()">Download</button>
            </div>
            <div id="download-from-url-feedback" class="invalid-feedback">Please enter an valid URL.</div>
            <form id="scriptForm" enctype="multipart/form-data">
                <div class="d-flex align-items-center">
                    <label for="text-editor" class="form-label">Text</label>
                    <div id="checkmark-download" class="checkmark hide">
                        <svg version="1.1" x="0px" y="0px" width="18px" height="18px" viewBox="0, 0, 100, 100" id="checkmark-svg">
                            <g transform="">
                                <circle id="path-download" class="path" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <circle id="fill-download" class="fill" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <polyline id="check-download" class="check" fill="none" stroke="#7DB0D5" stroke-width="14" stroke-linecap="round" stroke-miterlimit="10" points="70,35 45,65 30,52"/>
                            </g>
                        </svg>
                    </div>
                </div>
                <div class="mb-3">
                    <!-- <textarea class="form-control numbered" id="exampleFormControlTextarea1" rows="15"></textarea> -->
                    <textarea id="text-editor" class="code border"></textarea>
                    <input type="hidden" class="form-control" id="file-script" name="file">
                    <div id="script-feedback" class="invalid-feedback hide">Please enter an your script.</div>
                </div>
                <div class="mb-3 d-flex align-items-center">
                    <button id="submit-script-btn" type="button" class="btn btn-primary" style="margin-right: 10px;" onclick="submitScript()">Submit</button>
                    <div id="checkmark-submit-script" class="checkmark hide" style="padding-top: 3px">
                        <svg version="1.1" x="0px" y="0px" width="30px" height="30px" viewBox="0, 0, 100, 100" id="checkmark-svg">
                            <g transform="">
                                <circle id="path-submit-script" class="path" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <circle id="fill-submit-script" class="fill" fill="none" stroke="#7DB0D5" stroke-width="7" stroke-miterlimit="10" cx="50" cy="50" r="44"/>
                                <polyline id="check-submit-script" class="check" fill="none" stroke="#7DB0D5" stroke-width="14" stroke-linecap="round" stroke-miterlimit="10" points="70,35 45,65 30,52"/>
                            </g>
                        </svg>
                    </div>
                </div>
            </form>
            <div id="response-script" class="mt-3" style="display: none; position: relative;"></div>
            <div class="modal fade" id="qrCodeModal-response-script" tabindex="-1" aria-labelledby="qrCodeModalLabel-response-script" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="qrCodeModalLabel-response-script">Scan QR code</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body d-flex justify-content-center align-items-center">
                            <div id="qrCodeContainer-response-script"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="operator-notes">
        <span>OPERATOR NOTES</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#operator-notes" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <p>If you run a server and like this site, clone it! Centralization is bad.</p>
            <a href="https://git.0x0.st/mia/0x0">https://git.0x0.st/mia/0x0</a>
            <p>Hosting costs about 60 EUR a month.</p>
            <p>You can also support Original author Mia financially via libreapay.</p>
            <div class="col-md-12" style="margin-bottom: 20px;">
                <a href="https://liberapay.com/mia/donate">
                    <img src="https://img.shields.io/liberapay/receives/mia.svg?logo=liberapay">
                </a>
            </div>
            <p>If you wish to make just a small one-time donation, that is cool too!</p>
            <p>It will go towards my coffee habits.</p>
        </div>
    </div>
</div>
<div class="col-md-12 mb-4 border rounded-4 p-3">
    <h2 id="file-retention-period">
        <span>FILE RETENTION PERIOD</span>
        <a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="#" href="#file-retention-period" style="padding-left: 0.375em;"></a>
    </h2>
    <div class="row">
        <div class="col-md-12 indented-content">
            <p><code>retention = min_age + (-max_age + min_age) * pow((file_size / max_size - 1), 3)</code></p>
            <!-- Render plot -->
            <canvas id="retentionChart"></canvas>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js"></script>
<!-- Bootstrap Chart JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0"></script>
<!-- Bootstrap Datepicker JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/default-passive-events"></script>
<!-- Bootstrap QR Code generation JS -->
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<!-- CodeMirror -->
<script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css"></link>
<!-- Customize JS -->
<script src="{{ url_for('static', filename='app.js') }}"></script>
<script type="text/javascript">
    var min_age = {{'{: 6}'.format(config.get("FHOST_MIN_EXPIRATION", 2592000000)/86400000)}};
    var max_age = {{'{: 6}'.format(config.get("FHOST_MAX_EXPIRATION", 2592000000)/86400000)}};
    var max_size = {{'{: 6}'.format(config["MAX_CONTENT_LENGTH"] / 1024 / 1024)}};
    
    function calculate_retention(file_size, min_age, max_age, max_size) {
        return min_age + (-max_age + min_age) * Math.pow((file_size / max_size - 1), 3);
    }
    
    var data_x = [];
    var data_y = [];
    for (let i = 0; i <= max_size; i += 16) {
        data_x.push(i);
        data_y.push(calculate_retention(i, min_age, max_age, max_size));
    }
    
    var retentionChart = new Chart(document.getElementById('retentionChart'), {
        type: 'line',
        data: {
            labels: data_x,
            datasets: [{
                label: 'Retention',
                data: data_y,
                borderColor: '#d882d2',
                fill: false
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'File Size (MB)'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Retention (Days)'
                    },
                    suggestedMin: 0
                }
            }
        }
    });
</script>
{% endblock %}